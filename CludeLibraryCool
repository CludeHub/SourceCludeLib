-- ModuleScript named "CommandUI" inside ReplicatedStorage or similar
local CommandUI = {}

local commands = {}
local uiElements = {}

function CommandUI:Create()
	local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
	ScreenGui.Name = "ExploitCommandUI"
	ScreenGui.ResetOnSpawn = false

	local UIScale = Instance.new("UIScale", ScreenGui)
	UIScale.Scale = 1

	local MainFrame = Instance.new("Frame", ScreenGui)
	MainFrame.Size = UDim2.new(0, 270, 0, 380)
	MainFrame.Position = UDim2.new(0.5, -135, 0.5, -190)
	MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
	MainFrame.BorderSizePixel = 0

	local TopBar = Instance.new("Frame", MainFrame)
	TopBar.Size = UDim2.new(1, 0, 0, 30)
	TopBar.BackgroundColor3 = Color3.fromRGB(0, 110, 170)

	local Title = Instance.new("TextLabel", TopBar)
	Title.Size = UDim2.new(1, 0, 1, 0)
	Title.Text = "COMMANDS"
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.Font = Enum.Font.SourceSansBold
	Title.TextSize = 20
	Title.BackgroundTransparency = 1

	local Close = Instance.new("TextButton", TopBar)
	Close.Size = UDim2.new(0, 30, 1, 0)
	Close.Position = UDim2.new(1, -30, 0, 0)
	Close.Text = "X"
	Close.BackgroundColor3 = Color3.fromRGB(170, 50, 50)
	Close.TextColor3 = Color3.fromRGB(255, 255, 255)
	Close.Font = Enum.Font.SourceSansBold
	Close.TextSize = 18

	Close.MouseButton1Click:Connect(function()
		ScreenGui:Destroy()
	end)

	local InputBox = Instance.new("TextBox", MainFrame)
	InputBox.Size = UDim2.new(1, -20, 0, 28)
	InputBox.Position = UDim2.new(0, 10, 0, 35)
	InputBox.PlaceholderText = "fly 100"
	InputBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	InputBox.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	InputBox.Font = Enum.Font.SourceSans
	InputBox.TextSize = 16
	InputBox.ClearTextOnFocus = false
	InputBox.Text = ""

	local CommandList = Instance.new("ScrollingFrame", MainFrame)
	CommandList.Size = UDim2.new(1, -20, 1, -75)
	CommandList.Position = UDim2.new(0, 10, 0, 70)
	CommandList.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
	CommandList.BorderSizePixel = 0
	CommandList.CanvasSize = UDim2.new(0, 0, 0, 0)
	CommandList.AutomaticCanvasSize = Enum.AutomaticSize.Y
	CommandList.ScrollBarThickness = 4

	local Layout = Instance.new("UIListLayout", CommandList)
	Layout.SortOrder = Enum.SortOrder.LayoutOrder
	Layout.Padding = UDim.new(0, 4)

	uiElements.CommandList = CommandList
	uiElements.InputBox = InputBox
end

-- Adds a visible command to the list
function CommandUI:AddList(text)
	if not uiElements.CommandList then return end
	local label = Instance.new("TextLabel", uiElements.CommandList)
	label.Size = UDim2.new(1, -5, 0, 24)
	label.Text = text
	label.Font = Enum.Font.SourceSans
	label.TextSize = 16
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.fromRGB(200, 200, 200)
	label.TextXAlignment = Enum.TextXAlignment.Left
end

-- Registers a command and callback
function CommandUI:AddCommand(pattern, callback)
	local cleaned = pattern:gsub("<%w+>", "(.+)")
	table.insert(commands, {
		pattern = pattern,
		regex = "^" .. cleaned .. "$",
		callback = callback
	})

	-- Hook listener only once
	if not uiElements.InputBox:GetAttribute("Hooked") then
		uiElements.InputBox:GetPropertyChangedSignal("Text"):Connect(function()
			local text = uiElements.InputBox.Text
			for _, cmd in ipairs(commands) do
				local match = {string.match(text, cmd.regex)}
				if #match > 0 then
					cmd.callback(table.unpack(match))
				end
			end
		end)
		uiElements.InputBox:SetAttribute("Hooked", true)
	end
end

return CommandUI
